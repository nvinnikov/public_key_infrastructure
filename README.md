**ПРАВИТЕЛЬСТВО РОССИЙСКОЙ ФЕДЕРАЦИИ**

**Федеральное государственное автономное образовательное учреждение высшего профессионального образования**

**Национальный исследовательский университет**

**«Высшая школа экономики»**

**Московский институт электроники и математики**

**Департамент прикладной математики**

**Кафедра «Компьютерная безопасность»**

**ДОМАШНЯЯ РАБОТА**

**«Инфраструктура открытых ключей»**

**Выполнил:**** Винников Н.В.**

**Москва 2023 г.**

## Оглавление

[Оглавление 1](#_ul1bet11k9zo)

[Задание 2](#_eompngolcnfx)

[Введение в SSL и цифровые сертификаты 2](#_hh7f6feb0328)

[Работа с УЦ и выпуск сертификатов 2](#_3sassju2mww5)

[Обзор доверенных УЦ и их роль в процессе выпуска SSL сертификатов 3](#_5jfom8flww4)

[Запрос и выпуск SSL сертификата у доверенного УЦ 3](#_7scf1cwzscj)

[Определение параметров SSL-сертификата 4](#_v0m9wo3ero1x)

[Установка и использование выпущенного сертификата на сервере и клиенте 5](#_616l9j7h9sop)

[Управление и обновление SSL сертификатов 6](#_40rzqesbk3d5)

[Понятие срока действия сертификата и его влияние на безопасность 6](#_lw9u639ivu18)

[Обновление и перевыпуск сертификатов перед истечением срока действия 6](#_u9t787z8td4x)

[Управление списками отозванных сертификатов (CRL) и применение механизмов отзыва сертификатов (CRL и OCSP) 7](#_cautskp0zguj)

[Создание самоподписанных сертификатов 7](#_ycd4f5oq1fy1)

[Подписание самоподписанного сертификата с помощью собственного корневого УЦ: 10](#_81vn1nh35kel)

[Реализация SSL веб-соединений на примере Python Flask 18](#_d5ggsia5xw39)

[Установка SSL-сертификата на сервер и проверка подлинности сертификата на клиенте 19](#_lk2zqa20sh8z)

[Обзор литературы и ссылки 20](#_y21gimjpbqpr)

##


##


## Задание

С помощью инструментария OpenSSL сделать мини-УЦ, выпустить корневой сертификат и пользовательский сертификат, подписав его на корневой ключевой паре. Провести все осмысленно, понимая и комментируя, что происходит, умея задавать значения полей сертификатов и т.д.

## Введение в SSL и цифровые сертификаты

Протокол SSL (Secure Sockets Layer) является криптографическим протоколом, который обеспечивает безопасное соединение между клиентом и сервером в сети Интернет. Он обеспечивает защиту данных, аутентификацию и целостность информации, передаваемой между двумя узлами.

Роль SSL протокола заключается в обеспечении безопасности веб-соединений. Когда пользователь взаимодействует с веб-сайтом, SSL протокол создает защищенный туннель между клиентом и сервером, который шифрует данные и защищает их от несанкционированного доступа. Это особенно важно при передаче конфиденциальной информации, такой как пароли, кредитные карты или личные данные.

Одним из ключевых компонентов SSL являются цифровые сертификаты. Цифровой сертификат - это электронный документ, который содержит информацию о владельце сертификата, публичный ключ владельца и цифровую подпись удостоверяющего центра (УЦ). Цифровой сертификат играет важную роль в процессе проверки подлинности серверов и создании доверия у пользователей.

Цифровые сертификаты выпускаются удостоверяющими центрами (УЦ). УЦ являются доверенными сторонами, которые выпускают и подтверждают подлинность сертификатов. Они имеют корневые сертификаты, которые являются источниками доверия для остальных сертификатов в иерархии. Когда клиент взаимодействует с сервером, он проверяет подлинность сертификата путем проверки цепочки доверия до корневого сертификата.

Существуют два основных типа SSL сертификатов: самоподписанные сертификаты и сертификаты, выпускаемые УЦ. Самоподписанные сертификаты создаются и подписываются самим владельцем сертификата без участия УЦ. Они могут использоваться для локальной разработки и тестирования, но не гарантируют проверку подлинности открытого ключа сервера. Сертификаты, выпускаемые УЦ, являются доверенными и подтверждают подлинность сервера, так как они подписаны приватным ключом УЦ.

## Работа с УЦ и выпуск сертификатов

В этом разделе мы рассмотрим работу с доверенными УЦ (Удостоверяющими Центрами) и процесс выпуска SSL сертификатов.

### Обзор доверенных УЦ и их роль в процессе выпуска SSL сертификатов

Доверенные УЦ являются организациями или учреждениями, которые выпускают и подписывают SSL сертификаты. Они служат доверенным центром, который гарантирует подлинность и надежность сертификатов.

Роль доверенных УЦ в процессе выпуска SSL сертификатов заключается в следующем:

1. Проверка подлинности: Доверенный УЦ проводит проверку подлинности заявителя на сертификат. Это включает проверку владения доменом, организационной принадлежности и других реквизитов.

2. Подписание сертификатов: После успешной проверки доверенный УЦ подписывает SSL сертификаты с использованием своего собственного закрытого ключа. Подписанный сертификат становится доверенным и может быть использован для проверки подлинности серверов.

3. Распространение сертификатов: Доверенный УЦ распространяет подписанные сертификаты, чтобы они стали доступными для клиентских устройств. Это может включать публикацию сертификатов в центральных репозиториях или их распространение через другие механизмы.

### Запрос и выпуск SSL сертификата у доверенного УЦ

Чтобы получить SSL сертификат от доверенного УЦ, владелец сервера должен создать запрос на сертификат (Certificate Signing Request, CSR) и отправить его УЦ. CSR содержит информацию о владельце сертификата, которую доверенный УЦ будет использовать при выпуске сертификата.

Процесс запроса и выпуска SSL сертификата у доверенного УЦ включает следующие шаги:

1. Генерация закрытого ключа: Владелец сервера генерирует закрытый ключ, который будет использоваться для шифрования и расшифровки данных. Этот ключ должен быть хорошо защищен и не должен быть доступен посторонним лицам.

2. Создание запроса на сертификат (CSR): Владелец сервера создает CSR, который содержит информаци

ю о владельце сертификата, такую как доменное имя, название организации и контактные данные. CSR также включает публичный ключ, связанный с закрытым ключом.

3. Отправка CSR доверенному УЦ: Владелец сервера отправляет CSR доверенному УЦ для обработки и выпуска сертификата. Это может быть сделано через веб-интерфейс УЦ или другим установленным методом связи.

4. Проверка и выпуск сертификата: Доверенный УЦ проверяет подлинность информации, указанной в CSR, и проводит необходимые проверки. Если проверка прошла успешно, УЦ выпускает SSL сертификат, подписывая его с использованием своего закрытого ключа.

5. Получение и установка выпущенного сертификата: Владелец сервера получает выпущенный сертификат от доверенного УЦ. Затем сертификат может быть установлен на сервере для использования в безопасных соединениях.

### Определение параметров SSL-сертификата

SSL-сертификаты содержат различные параметры, которые определяют информацию о владельце сертификата, срок его действия, цифровую подпись и другие сведения. В этом разделе мы рассмотрим основные параметры SSL-сертификата и их значения.

1. Subject (Субъект): Параметры, связанные с информацией о владельце сертификата. Включает следующие поля:

- Common Name (CN): Основное имя субъекта, обычно указывает на доменное имя сервера.

- Organization (O): Название организации, к которой относится субъект.

- Organizational Unit (OU): Название подразделения или отдела организации.

- Locality (L): Название города или населенного пункта, где находится субъект.

- State or Province (ST): Название штата или провинции, где находится субъект.

- Country (C): Двухбуквенный код страны, где находится субъект.

2. Issuer (Издатель): Параметры, связанные с информацией об удостоверяющем центре (УЦ), который выпустил сертификат. Обычно содержит те же поля, что и Subject.

3. Serial Number (Серийный номер): Уникальный номер сертификата, выдаваемый УЦ.

4. Validity (Срок действия): Указывает период, в течение которого сертификат считается действительным. Включает следующие поля:

- Not Before: Дата и время начала действия сертификата.

- Not After: Дата и время окончания действия сертификата.

5. Public Key (Открытый ключ): Криптографический ключ, который используется для шифрования и проверки подписей.

6. Signature Algorithm (Алгоритм подписи): Алгоритм, используемый для создания цифровой подписи сертификата.

7. Extensions (Расширения): Дополнительные параметры сертификата, которые могут содержать дополнительную информацию или ограничения. Например, расширение Subject Alternative Name (SAN) позволяет указать альтернативные имена сервера.

При создании самоподписанных сертификатов с помощью OpenSSL можно задавать значения этих параметров, используя параметры командной строки или файлы конфигурации, такие как openssl.cnf.

Таким образом, определение параметров SSL-сертификата позволяет задать информацию о владельце, сроке действия, публичном ключе и других характеристиках сертификата, что обеспечивает его уникальность и подлинность.

### Установка и использование выпущенного сертификата на сервере и клиенте

После получения выпущенного SSL сертификата от доверенного УЦ, его можно установить и использовать на сервере и клиенте для обеспечения безопасных соединений.

На стороне сервера:

1. Загрузите выпущенный сертификат на сервер.

2. Укажите серверу использовать этот сертификат в настройках серверного программного обеспечения. Например, для веб-сервера Apache можно указать путь к сертификату в конфигурационном файле.

3. Перезапустите серверное программное обеспечение, чтобы изменения вступили в силу.

На стороне клиента:

1. Клиентский код, который выполняет запросы к серверу, должен иметь доступ к доверенным корневым сертификатам. Корневые сертификаты предоставляются доверенными УЦ и обеспечивают проверку подлинности сервера.

2. Клиентский код должен быть настроен на проверку подлинности сервера с использованием установленного сертификата. Это может быть выполнено путем указания пути к корневым сертификатам или их импорта в хранилище сертификатов клиента.

3. Клиентский код может использовать библиотеки и инструменты, такие как `requests` в Python, для выполнения запросов к серверу с использованием SSL сертификата.

После правильной установки и использования выпущенного сертификата на сервере и клиенте, безопасные соединения между ними могут быть установлены с использованием SSL/TLS протокола, обеспечивая шифрование и проверку подлинности.

## Управление и обновление SSL сертификатов

### Понятие срока действия сертификата и его влияние на безопасность

SSL сертификаты имеют ограниченный срок действия, определяемый при их выпуске. Срок действия указывает период времени, в течение которого сертификат считается действительным. Это важно для обеспечения безопасности, так как срок действия ограничивает период, в течение которого сертификат может использоваться для установления доверенного соединения.

Истечение срока действия сертификата имеет прямое влияние на безопасность. После истечения срока действия сертификата он становится недействительным, и его использование может быть рассматриваться как небезопасное действие. Поэтому владелец сервера должен обеспечить своевременное обновление и перевыпуск сертификатов перед истечением срока их действия.

### Обновление и перевыпуск сертификатов перед истечением срока действия

Для обеспечения непрерывной безопасности серверных соединений необходимо своевременно обновлять и перевыпускать SSL сертификаты перед истечением их срока действия. Это включает в себя следующие шаги:

1. Отслеживание срока действия сертификатов: Владелец сервера должен активно отслеживать сроки действия своих сертификатов. Это может быть выполнено с использованием календарных напоминаний, систем уведомлений или автоматических инструментов, которые могут предупреждать о приближающейся дате истечения срока действия сертификата.

2. Обновление закрытого ключа: При обновлении сертификата может потребоваться также обновить закрытый ключ, связанный с ним. Обновление закрытого ключа помогает обеспечить дополнительный уровень безопасности.

3. Подготовка запроса на перевыпуск: Владелец сервера должен подготовить новый запрос на сертификат (CSR) с теми же или обновленными данными, что и в предыдущем сертификате. Это может включать обновление информации о владельце, дополнительных доменных имен или расширений сертификата.

4. Подписание нового сертификата: Запрос на перевыпуск отправляется доверенному УЦ для подписания нового сертификата. Подписание выполняется УЦ, используя их приватный ключ, и создается новый сертификат, заменяющий старый.

5. Установка нового сертификата: После получения нового сертификата от УЦ, владелец сервера должен установить его на сервере, заменив предыдущий сертификат. Это включает в себя установку нового сертификата и соответствующего закрытого ключа.

6. Проверка и тестирование: После установки нового сертификата необходимо провести проверку и тестирование, чтобы убедиться, что сервер правильно использует новый сертификат и что соединение устанавливается без ошибок.

### Управление списками отозванных сертификатов (CRL) и применение механизмов отзыва сертификатов (CRL и OCSP)

Управление списками отозванных сертификатов (CRL) является важной частью инфраструктуры открытых ключей. Когда сертификат становится недействительным до истечения его срока действия, например, в случае утраты закрытого ключа или компрометации сертификата, он может быть отозван. Отзыв сертификата указывает на то, что сертификат больше не должен использоваться для установления безопасного соединения.

УЦ поддерживает список отозванных сертификатов (CRL), который содержит информацию о сертификатах, которые были отозваны. Клиенты могут проверять CRL для определения статуса сертификата перед установкой безопасного соединения. Если сертификат присутствует в CRL, то он считается отозванным и не должен использоваться.

В дополнение к CRL, механизм отзыва сертификатов (OCSP) может быть использован для проверки статуса сертификата в реальном времени. Клиенты могут отправлять запросы OCSP на УЦ, чтобы получить информацию о статусе сертификата.

Управление списками отозванных сертификатов и применение механизмов отзыва сертификатов являются важными шагами для обеспечения безопасности SSL соединений. Они позволяют оперативно реагировать на угрозы и обеспечивают доверие к сертификатам в системе.

## Создание самоподписанных сертификатов

Генерация закрытого ключа и запроса на самоподписанный сертификат с использованием OpenSSL:

Для создания самоподписанного сертификата мы будем использовать инструмент OpenSSL. OpenSSL предоставляет средства для работы с цифровыми сертификатами и ключами.

Шаг 1: Генерация закрытого ключа:

Первым шагом мы генерируем закрытый ключ, который будет использоваться для шифрования и расшифровки данных. Мы можем использовать команду OpenSSL для создания закрытого ключа с помощью алгоритма RSA:

openssl genpkey -algorithm RSA -out private.key

_openssl: это имя самой команды, которая вызывает утилиту OpenSSL._

_genpkey: это подкоманда OpenSSL, которая используется для генерации закрытых ключей._

_-algorithm RSA: этот аргумент указывает алгоритм шифрования, который будет использоваться для генерации закрытого ключа. В данном случае используется алгоритм RSA._

_-out private.key: этот аргумент определяет имя файла, в который будет сохранен сгенерированный закрытый ключ. В данном случае закрытый ключ будет сохранен в файле с именем private.key._

_Совместно эти аргументы задают команду для генерации закрытого ключа с использованием алгоритма RSA и сохранения его в файле private.key._

➜ **ossl** openssl genpkey -algorithm RSA -out private.key

...........+++++

...........+++++

➜ **ossl** cat private.key

-----BEGIN PRIVATE KEY-----

MIIEwAIBADANBgkqhkiG9w0BAQEFAASCBKowggSmAgEAAoIBAQDWZafoLwNWmsUn

L/FU6EBuA9Lkgdq2OMwwgSQRD52Zp6XIpkJ1yaYLtFf2NysE0nFJXOeK9IwQPmHV

QtpcP51XnFIhpbrqh3D+s/1bQGPVDnnXqMlWG+Z7N/ujLmMpNDNS9znKFzltCss+

Mkim7Rf258SJoYhL74ZAdFTSd3uoM3GgmOxYGPMn3VexHBAI7XNAgb/OvRO3ZmTV

tyGCk7+wVx6HnGgAZydMBc7U4/atKT4ztbUdw2hKCsE95nI+qMKnjkWjIii8bD3J

HDUE7m+dlaYQYxegWAiZQcAq9vIEaDTk4wjaJAWZe5tKINvaxgypwrDkhLG6Vucj

AP0GrAi9AgMBAAECggEBAKcfSslUjFegAXrQhmBXQpH/bQ8uodxVXeWZZRHfiExU

QIiuATRr4YFSLRcCXgg+OoyjXOIWSnAHEJ/6otgxxmaatfMAizlyJoSErUPKZ4eW

5ydSrM7wpLL8Kq1C5Y0i4bcUe/mqLNtxBIkRDU0BmCKg+7UFM4dtyMrJY61D8iJj

ubt1bjEddbnP6Xz3rW6QZ/Lno7HdljxU9wkxidSaDJgZNa8tJcXFSV1dBOy/JqBN

JJWCrLvScaT2rk6ylqIDZTTZBS0ju3aRPy9xz8xXZjLnKyYlgB0NAe/04Y+x8o+N

URs798uUzOiWUvI8s2XUDbjYxU2vRMHQkN8qV2g9cMECgYEA9tbes50iWIOC4Ivr

4T/uEJ7gI/4/n8oUyjr5bSmh+iJjiimC1S2/36uxAm0xy5fibotD7VposGQ2fx3Q

J+pCmmoBGA/qDRJNzeq9ZrlJvdkCGwr368ZXK7OxAKRBVvi+U2T3+ch/anCduJpo

uxQaftutTp1b96ApiJqefF2tQwkCgYEA3lqQaQZu3h2qURN7o4YcBsfCG6bKcZot

egVn2SN++umd1vlU1Ko1RTAHfrF1t4IuJE2drUWJ0N3Hkt5EGw+524IkoAd0FB3A

uDTMO7fl/LF0+YfYhgJypCplA1/YZt80iUpfpK8uR7oYDB2n4jlg1v5UF7/vZaio

aOg9/Qi+gRUCgYEAyZy9L6WjvPpFttRyaHvIHgk2eA+dtgzfqEI9Ij2EEINwHBRF

yYthkfZxUNMRfgJjrvjPFZnnslNX88HNGB0OI4N7u0ScXeraY9tcsf+bTJZoUuBF

mW1aG9bcNvLyb3AiPIlWxc1OzQiIupRcAJmt/nm9d12uFXbbFbl8w4XcE8kCgYEA

rHuoRjA9VIPCmL36TPE9UG0ov/Z0WAd3e44x7pjAabdLP3WOPqICTLdjOP5ECKQt

Uu/6fmzQ6XsA04cjYbKjRAoCizj87JXf54TdYP3YpFqsGN0uM1Y2w+43CZUR80r2

IAHXi5Jw3icXfF6M2soTuvLzHLFA7aUVbrupSl28GbkCgYEAzhGC0d6R7evBQVax

AAmWFU+pkFXvkSr8B3ggxoB4GmU+dp7U5XKbWmt394ZNgc5ATkSLcG+hxKOSYydu

WWKcPDYfJFzPXL8OFYRc2eMJJ/IqOVRhNhM/A5FEPHxzgKMCy1C6uO8dFQsJ7LhU

CqWdw6fmTYZxgSLHk52PqppmAxM=

-----END PRIVATE KEY-----

Шаг 2: Создание запроса на самоподписанный сертификат:

Затем мы создаем запрос на самоподписанный сертификат, который будет содержать информацию о владельце сертификата, такую как его имя, организация и т.д. Мы можем использовать команду OpenSSL для создания запроса на самоподписанный сертификат:

openssl req -new -key private.key -out request.csr

_openssl: это имя самой команды, которая вызывает утилиту OpenSSL._

_req: Это подкоманда OpenSSL, используемая для создания и обработки запросов на сертификаты._

_-new: Этот флаг указывает на создание нового запроса на сертификат. Он сообщает OpenSSL, что нужно сгенерировать новый CSR._

_-key private.key: С помощью этого аргумента задается путь к приватному ключу (private.key), который будет использоваться для создания подписи в CSR. Здесь private.key должен быть путь к файлу, содержащему приватный ключ._

_-out request.csr: Этот аргумент задает путь и имя файла (request.csr), в котором будет сохранен созданный запрос на сертификат (CSR). В данном случае, request.csr - это путь к файлу, в который будет сохранен результат выполнения команд_

_При выполнении этой команды OpenSSL запросит ввести информацию о владельце сертификата, такую как имя, организацию и т.д. Затем он создаст файл `request.csr`, который будет содержать запрос на самоподписанный сертификат._

➜ **ossl** openssl req -new -key private.key -out request.csr

You are about to be asked to enter information that will be incorporated

into your certificate request.

What you are about to enter is what is called a Distinguished Name or a DN.

There are quite a few fields but you can leave some blank

For some fields there will be a default value,

If you enter '.', the field will be left blank.

-----

Country Name (2 letter code) []:RU

State or Province Name (full name) []:Moscow

Locality Name (eg, city) []:Moscow

Organization Name (eg, company) []:MIEM

Organizational Unit Name (eg, section) []:HSE

Common Name (eg, fully qualified host name) []:localhost

Email Address []:nvinnikov@miem.hse.ru

Please enter the following 'extra' attributes

to be sent with your certificate request

A challenge password []:

➜ **ossl** cat request.csr

-----BEGIN CERTIFICATE REQUEST-----

MIICzDCCAbQCAQAwgYYxCzAJBgNVBAYTAlJVMQ8wDQYDVQQIDAZNb3Njb3cxDzAN

BgNVBAcMBk1vc2NvdzENMAsGA1UECgwETUlFTTEMMAoGA1UECwwDSFNFMRIwEAYD

VQQDDAlsb2NhbGhvc3QxJDAiBgkqhkiG9w0BCQEWFW52aW5uaWtvdkBtaWVtLmhz

ZS5ydTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANZlp+gvA1aaxScv

8VToQG4D0uSB2rY4zDCBJBEPnZmnpcimQnXJpgu0V/Y3KwTScUlc54r0jBA+YdVC

2lw/nVecUiGluuqHcP6z/VtAY9UOedeoyVYb5ns3+6MuYyk0M1L3OcoXOW0Kyz4y

SKbtF/bnxImhiEvvhkB0VNJ3e6gzcaCY7FgY8yfdV7EcEAjtc0CBv869E7dmZNW3

IYKTv7BXHoecaABnJ0wFztTj9q0pPjO1tR3DaEoKwT3mcj6owqeORaMiKLxsPckc

NQTub52VphBjF6BYCJlBwCr28gRoNOTjCNokBZl7m0og29rGDKnCsOSEsbpW5yMA

/QasCL0CAwEAAaAAMA0GCSqGSIb3DQEBCwUAA4IBAQBOMjymJATMlGKPMbXavEdq

Ay7eIu/I51ayyC1HAZHUR3kfg386xEiisoQR4GN85ysI/rIVI0/voU6KGX+4xTea

4bhLFOSaNCxQNOK0b4oRGDYBQsBKq6tmO3bP/Tq+IDkgLOh+6owN5JMdO+dX3P7n

nH+6+wVA2M3xHSWrSRqHpCwR6ptgGU9mp0GldnC5s6WLOGQwwYjBLta5tMx2W4ig

UmIdP8sObabaT1IUDoNqCkFcStcZEEjUDHAY6xMASTBDEP5ii6rMiyKKc36ZoZjH

sSCt5y6Y3yzeHwBMJjhorxtpcCtx6fnKazlOTZRW5ERty+2sGE30L3+UrlyamwvB

-----END CERTIFICATE REQUEST-----

### Подписание самоподписанного сертификата с помощью собственного корневого УЦ:

После создания запроса на самоподписанный сертификат мы можем подписать его с помощью собственного корневого УЦ. Корневой УЦ представляет собой доверенный центр, который выпускает и подписывает сертификаты.

Шаг 1: Создание корневого сертификата:

Первым шагом мы создаем корневой сертификат, который будет использоваться для подписи самоподписанных сертификатов. Мы можем использовать команду OpenSSL для создания корневого сертификата:

openssl req -x509 -new -key private.key -out root.crt

_openssl: это имя самой команды, которая вызывает утилиту OpenSSL._

_req: Этот аргумент указывает на использование подкоманды "req", которая отвечает за запросы на сертификаты._

_-x509: Этот аргумент указывает на создание самозаверяющего сертификата (self-signed certificate) вместо запроса на сертификат (certificate request)._

_-new: Этот аргумент указывает на создание нового сертификата или запроса на сертификат. В данном случае, он означает создание нового самозаверяющего сертификата._

_-key private.key: Этот аргумент указывает на использование файла private.key в качестве закрытого ключа (private key) для создания сертификата. Здесь предполагается, что файл private.key содержит закрытый ключ, необходимый для создания сертификата._

_-out root.crt: Этот аргумент указывает на сохранение созданного сертификата в файл с именем root.crt. Здесь root.crt - это имя файла, в который будет сохранен самозаверяющий сертификат._

_Таким образом, команда openssl req -x509 -new -key private.key -out root.crt создает самозаверяющий сертификат, используя закрытый ключ из файла private.key и сохраняет его в файл root.crt._

➜ **ossl** openssl req -x509 -new -key private.key -out root.crt

You are about to be asked to enter information that will be incorporated

into your certificate request.

What you are about to enter is what is called a Distinguished Name or a DN.

There are quite a few fields but you can leave some blank

For some fields there will be a default value,

If you enter '.', the field will be left blank.

-----

Country Name (2 letter code) []:RU

State or Province Name (full name) []:Moscow

Locality Name (eg, city) []:Moscow

Organization Name (eg, company) []:HSE

Organizational Unit Name (eg, section) []:MIEM

Common Name (eg, fully qualified host name) []:localhost

Email Address []:nvinnikov@miem.hse.ru

➜ **ossl** cat root.crt

-----BEGIN CERTIFICATE-----

MIIDijCCAnICCQDpvIM0rJW9GzANBgkqhkiG9w0BAQsFADCBhjELMAkGA1UEBhMC

UlUxDzANBgNVBAgMBk1vc2NvdzEPMA0GA1UEBwwGTW9zY293MQwwCgYDVQQKDANI

U0UxDTALBgNVBAsMBE1JRU0xEjAQBgNVBAMMCWxvY2FsaG9zdDEkMCIGCSqGSIb3

DQEJARYVbnZpbm5pa292QG1pZW0uaHNlLnJ1MB4XDTIzMDYyMjE5MjY1OVoXDTIz

MDcyMjE5MjY1OVowgYYxCzAJBgNVBAYTAlJVMQ8wDQYDVQQIDAZNb3Njb3cxDzAN

BgNVBAcMBk1vc2NvdzEMMAoGA1UECgwDSFNFMQ0wCwYDVQQLDARNSUVNMRIwEAYD

VQQDDAlsb2NhbGhvc3QxJDAiBgkqhkiG9w0BCQEWFW52aW5uaWtvdkBtaWVtLmhz

ZS5ydTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANZlp+gvA1aaxScv

8VToQG4D0uSB2rY4zDCBJBEPnZmnpcimQnXJpgu0V/Y3KwTScUlc54r0jBA+YdVC

2lw/nVecUiGluuqHcP6z/VtAY9UOedeoyVYb5ns3+6MuYyk0M1L3OcoXOW0Kyz4y

SKbtF/bnxImhiEvvhkB0VNJ3e6gzcaCY7FgY8yfdV7EcEAjtc0CBv869E7dmZNW3

IYKTv7BXHoecaABnJ0wFztTj9q0pPjO1tR3DaEoKwT3mcj6owqeORaMiKLxsPckc

NQTub52VphBjF6BYCJlBwCr28gRoNOTjCNokBZl7m0og29rGDKnCsOSEsbpW5yMA

/QasCL0CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAdbI+/hFSxRzzraEgQceJ+Axs

wBtgvdJR8N4hfILkXdP2HCgEKrxoxwFkIDMqNvmbRkMamBh3W+nM1xz2Dkyxbqpg

M1CPu6OOU9NXMUkiOtbGtIbczdd2Eaw+TZD5ozXGzrTGiJWTsRL/FnG0NOPhQZC9

NUeJAiFC0clybv653dHRJJPm3PThtMRmoX8Amaz6UVJRPTt+U7dCQvpl6uSCP5pb

iLMVZGrK566Ke6SvgXRvGcJ/0WUGFWhJcsv8NfXYGqwLLRh5MJPzz9fad4W0fcRo

pT8WI2grW038V++J86vc+h2PXYut/GrBo1sxvfVMn6zVEP8CZ05j+dbOGr2mVQ==

-----END CERTIFICATE-----

При выполнении этой команды OpenSSL попросил ввести информацию о владельце корневого сертификата. Затем он создал файл `root.crt`, который будет содержать корневой сертификат.

Шаг 2: Подписание самоподписанного сертификата:

Затем мы подписываем самоподписанный сертификат с помощью корневого сертификата. Мы можем использовать команду OpenSSL для этого:

openssl x509 -req -in request.csr -CA root.crt -CAkey private.key -CAcreateserial -out certificate.crt

_-req: Этот флаг указывает на то, что входной файл является запросом на сертификат (CSR)._

_-in request.csr: Этот аргумент задает входной файл request.csr, который содержит информацию о запросе на сертификат, отправленном к удостоверяющему центру (Certification Authority, CA)._

_-CA root.crt: Этот аргумент определяет файл корневого сертификата root.crt. Корневой сертификат представляет собой доверенный сертификат, используемый для проверки цепочки сертификации. Он является основой для создания сертификата, соответствующего запросу._

_-CAkey private.key: Этот аргумент задает закрытый ключ private.key, который принадлежит удостоверяющему центру (CA) и используется для подписи сертификата._

_-CAcreateserial: Этот флаг указывает на то, что серийный номер сертификата должен быть создан автоматически._

_-out certificate.crt: Этот аргумент определяет выходной файл certificate.crt, в который будет сохранен созданный сертификат X.509._

_Эта команда использует корневой сертификат и закрытый ключ для подписания самоподписанного сертификата, содержащегося в файле `request.csr`. Результат подписания сохраняется в файле `certificate.crt`._

➜ **ossl**

openssl x509 -req -in request.csr -CA root.crt -CAkey private.key -CAcreateserial -out certificate.crt

Signature ok

subject=/C=RU/ST=Moscow/L=Moscow/O=MIEM/OU=HSE/CN=localhost/emailAddress=nvinnikov@miem.hse.ru

Getting CA Private Key

➜ **ossl** cat certificate.crt

-----BEGIN CERTIFICATE-----

MIIDijCCAnICCQCtoxPMyyXycDANBgkqhkiG9w0BAQsFADCBhjELMAkGA1UEBhMC

UlUxDzANBgNVBAgMBk1vc2NvdzEPMA0GA1UEBwwGTW9zY293MQwwCgYDVQQKDANI

U0UxDTALBgNVBAsMBE1JRU0xEjAQBgNVBAMMCWxvY2FsaG9zdDEkMCIGCSqGSIb3

DQEJARYVbnZpbm5pa292QG1pZW0uaHNlLnJ1MB4XDTIzMDYyMjE5MjcyOFoXDTIz

MDcyMjE5MjcyOFowgYYxCzAJBgNVBAYTAlJVMQ8wDQYDVQQIDAZNb3Njb3cxDzAN

BgNVBAcMBk1vc2NvdzENMAsGA1UECgwETUlFTTEMMAoGA1UECwwDSFNFMRIwEAYD

VQQDDAlsb2NhbGhvc3QxJDAiBgkqhkiG9w0BCQEWFW52aW5uaWtvdkBtaWVtLmhz

ZS5ydTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANZlp+gvA1aaxScv

8VToQG4D0uSB2rY4zDCBJBEPnZmnpcimQnXJpgu0V/Y3KwTScUlc54r0jBA+YdVC

2lw/nVecUiGluuqHcP6z/VtAY9UOedeoyVYb5ns3+6MuYyk0M1L3OcoXOW0Kyz4y

SKbtF/bnxImhiEvvhkB0VNJ3e6gzcaCY7FgY8yfdV7EcEAjtc0CBv869E7dmZNW3

IYKTv7BXHoecaABnJ0wFztTj9q0pPjO1tR3DaEoKwT3mcj6owqeORaMiKLxsPckc

NQTub52VphBjF6BYCJlBwCr28gRoNOTjCNokBZl7m0og29rGDKnCsOSEsbpW5yMA

/QasCL0CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEALRivLhK8gLGaahSY7YiP4eak

7AxBexRE+fY7JPdShOwZXg9/NSQLS8FQb1CH9MxTISJorIJaNWMlEAyWBxjjIk1O

TpYYwqWkWdzC3BFnN0zXTU5MMU6++nHF5ziQQGsqH8LMMI2ExJio4IyOWsMGlFI4

7NRBq9iT54fmTrIwimSNG/+eN3r6oUJbJEZyEvl++pQlRpFMlmo/JKUY9M2/HxTj

33xEp5rklbJyGDX3C+Q9Kk4B/3SCuyPwfmxB2+B5Oqrpd57OH7m7Xg7377fsjEwb

HeS+8H+KgIjDP+t5NhqUkhp4loNzTlhNUWaL3nmgB46uBkMUTxg7vlXrcQxe4g==

-----END CERTIFICATE-----

Далее необходимо добавить сертификат в KeyChain (MacOS) и сделать его доверенным

![](image1.png)

![](image2.png) ![](image3.png) ![](image4.png)

![](image5.png)

В операционной системе Windows необходимо открыть "Управление компьютером" -\> "Службы и приложения" -\> "Сертификаты" -\> "Доверенные корневые центры сертификации" и импортировать root.crt

### Реализация SSL веб-соединений на примере Python Flask

После того, как мы создали самоподписанный сертификат, мы можем его применить на сервере и клиенте.

На стороне сервера:

Мы можем использовать выбранный сервер (например, веб-сервер Flask) и указать ему использовать самоподписанный сертификат. В примере ниже показано, как это можно сделать с использованием Flask:

python

from flask import Flask

app = Flask(\_\_name\_\_)

if \_\_name\_\_ == '\_\_main\_\_':

app.run(ssl\_context=('certificate.crt', 'private.key'), debug=True)

Здесь мы указываем Flask использовать самоподписанный сертификат `certificate.crt` и соответствующий закрытый ключ `private.key`.

На стороне клиента:

Клиентский код может использовать самоподписанный сертификат для проверки подлинности сервера. В примере ниже показано, как это можно сделать с использованием библиотеки `requests` в Python:

python

import requests

response = requests.get('https://localhost:5000', verify='certificate.crt')

print(response.text)

Здесь мы используем библиотеку `requests` для отправки запроса на сервер с самоподписанным сертификатом `certificate.crt` для проверки подлинности сервера.

Таким образом, мы можем создать и применить самоподписанный сертификат на сервере и клиенте, обеспечивая безопасное соединение между ними.

➜ python3 server.py

\* Serving Flask app 'server' (lazy loading)

\* Environment: production

WARNING: This is a development server. Do not use it in a production deployment.

Use a production WSGI server instead.

\* Debug mode: on

\* Running on https://127.0.0.1:5000/ (Press CTRL+C to quit)

\* Restarting with stat

\* Debugger is active!

\* Debugger PIN: 400-624-290

**127.0.0.1 - - [22/Jun/2023 22:28:28] "GET / HTTP/1.1" 200 -**

➜ python3 client.py

\* Hello, secure world!

### Установка SSL-сертификата на сервер и проверка подлинности сертификата на клиенте

Перейдем на наш сервер в браузере.

До добавления сертификата в keychain:

![](image6.png)
 ![](image7.png)

После добавления сертификата в keychain доверенные:

![](image8.png)

![](image9.png)

## Обзор литературы и ссылки

https://github.com/nvinnikov/public\_key\_infrastructure
